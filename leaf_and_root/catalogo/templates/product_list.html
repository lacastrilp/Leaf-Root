{% extends "base.html" %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'catalogo/css/product_list.css' %}">
<link rel="stylesheet" href="{% static 'catalogo/css/wishlist.css' %}">
<link rel="stylesheet" href="{% static 'catalogo/css/base.css' %}">

<!-- Hero a todo el ancho con la imagen como fondo debajo del texto -->
<div class="hero-banner" style="background-image: url('{% static 'store/images/banner.jpg' %}')">
    <div class="hero-text">
        <h1 class="display-5 mb-0 text-ink fw-bold">
            We're an online store specializing in plant-based products.
        </h1>
        <p class="lead space-h1-lead text-muted-1">
            Our platform promotes a healthy, ethical, and sustainable lifestyle
            by clearly labeling products as vegan or vegetarian and providing
            transparent information on their nutritional.
        </p>
    </div>
</div>

<!-- PÃ¡gina de inicio -->
<div class="container mt-5">
    
    <!-- SecciÃ³n de Productos Recomendados -->
    <div class="mb-5">
        <div class="mb-4">
            <h2 class="landing-title">Recommended Products</h2>
            <a href="{% url 'catalog' %}" class="btn btn-outline-success bi bi-eye"> View All</a>
        </div>
        <div class="row">
            {% for product in recommended_products %}
                <div class="col-md-3 mb-4">
                    <div class="card shadow-sm h-100 product-card">
                        <!-- ðŸ·ï¸ Etiqueta vegano/vegetariano -->
                        {% if product.diet_label == "vegan" %}
                            <span class="badge tags product-badge">Vegan</span>
                        {% elif product.diet_label == "vegetarian" %}
                            <span class="badge tags product-badge">Vegetarian</span>
                        {% endif %}
                        
                        <!-- â¤ï¸ Wishlist toggle -->
                        <form method="post" action="{% url 'toggle_wishlist' product.pk %}" 
                            class="wishlist-form" data-product-id="{{ product.pk }}">
                            {% csrf_token %}
                            <button type="submit" class="wishlist-button" aria-label="Toggle wishlist">
                                <i class="bi wishlist-icon {% if product.pk in wishlist_product_ids %}bi-heart-fill active{% else %}bi-heart{% endif %}"></i>
                            </button>
                        </form>
                        
                        <!-- Imagen del producto -->
                        {% if product.image %}
                            <a href="{% url 'product_detail' product.pk %}" class="product-link">
                                <img src="{{ product.image.url }}" class="card-img-top product-image" alt="{{ product.name }}">
                            </a>
                        {% elif product.image_url %}
                            <a href="{% url 'product_detail' product.pk %}" class="product-link">
                                <img src="{{ product.image_url }}" class="card-img-top product-image" alt="{{ product.name }}">
                            </a>
                        {% else %}
                            <a href="{% url 'product_detail' product.pk %}" class="product-link">
                                <img src="https://via.placeholder.com/200" class="card-img-top product-image" alt="No image available">
                            </a>
                        {% endif %}

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                <a href="{% url 'product_detail' product.pk %}" class="product-link text-dark text-decoration-none">{{ product.name }}</a>
                            </h5>
                            <p class="card-text text-muted">Price: <strong>${{ product.price }}</strong></p>
                            <div class="mt-auto">
                                {% if user.is_staff %}
                                    <a href="{% url 'edit_product' product.pk %}" class="btn btn-warning btn-sm">Edit</a>
                                    <a href="{% url 'delete_product' product.pk %}" class="btn btn-danger btn-sm">Remove</a>
                                {% else %}
                                    {% if product.stock > 0 %}
                                        <form method="post" action="{% url 'add_to_cart' product.pk %}" class="add-to-cart-form">
                                            {% csrf_token %}
                                            <input type="hidden" name="quantity" value="1">
                                            <button type="submit" class="btn btn-sm btn-success">
                                                Add to shopping cart
                                            </button>
                                        </form>
                                    {% else %}
                                        <button class="btn btn-sm btn-secondary" disabled>Out of stock</button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% empty %}
                <p class="text-center text-muted">No recommended products available.</p>
            {% endfor %}
        </div>
    </div>

    <!-- SecciÃ³n de Vistos Recientemente -->
    <div class="mb-5">
        <div class="mb-4">
            <h2 class="landing-title">Recently Viewed</h2>
        </div>
        
        <div class="row">
            {% for product in recently_viewed %}
                <div class="col-md-3 mb-4">
                    <div class="card shadow-sm h-100 product-card">
                        <!-- ðŸ·ï¸ Etiqueta vegano/vegetariano -->
                        {% if product.diet_label == "vegan" %}
                            <span class="badge tags product-badge">Vegan</span>
                        {% elif product.diet_label == "vegetarian" %}
                            <span class="badge tags product-badge">Vegetarian</span>
                        {% endif %}
                        
                        <!-- â¤ï¸ Wishlist toggle -->
                        <form method="post" action="{% url 'toggle_wishlist' product.pk %}" 
                            class="wishlist-form" data-product-id="{{ product.pk }}">
                            {% csrf_token %}
                            <button type="submit" class="wishlist-button" aria-label="Toggle wishlist">
                                <i class="bi wishlist-icon {% if product.pk in wishlist_product_ids %}bi-heart-fill active{% else %}bi-heart{% endif %}"></i>
                            </button>
                        </form>
                        
                        <!-- Imagen del producto -->
                        {% if product.image %}
                            <a href="{% url 'product_detail' product.pk %}" class="product-link">
                                <img src="{{ product.image.url }}" class="card-img-top product-image" alt="{{ product.name }}">
                            </a>
                        {% elif product.image_url %}
                            <a href="{% url 'product_detail' product.pk %}" class="product-link">
                                <img src="{{ product.image_url }}" class="card-img-top product-image" alt="{{ product.name }}">
                            </a>
                        {% else %}
                            <a href="{% url 'product_detail' product.pk %}" class="product-link">
                                <img src="https://via.placeholder.com/200" class="card-img-top product-image" alt="No image available">
                            </a>
                        {% endif %}

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                <a href="{% url 'product_detail' product.pk %}" class="product-link text-dark text-decoration-none">{{ product.name }}</a>
                            </h5>
                            <p class="card-text text-muted">Price: <strong>${{ product.price }}</strong></p>
                            <div class="mt-auto">
                                {% if user.is_staff %}
                                    <a href="{% url 'edit_product' product.pk %}" class="btn btn-warning btn-sm">Edit</a>
                                    <a href="{% url 'delete_product' product.pk %}" class="btn btn-danger btn-sm">Remove</a>
                                {% else %}
                                    {% if product.stock > 0 %}
                                        <form method="post" action="{% url 'add_to_cart' product.pk %}" class="add-to-cart-form">
                                            {% csrf_token %}
                                            <input type="hidden" name="quantity" value="1">
                                            <button type="submit" class="btn btn-sm btn-success">
                                                Add to shopping cart
                                            </button>
                                        </form>
                                    {% else %}
                                        <button class="btn btn-sm btn-secondary" disabled>Out of stock</button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% empty %}
                <p class="text-center text-muted">No recently viewed products.</p>
            {% endfor %}
        </div>
    </div>
</div>

<script src="{% static 'store/js/product-modal.js' %}"></script>
<script src="{% static 'carrito/js/cart.js' %}"></script>
<script src="{% static 'catalogo/js/wishlist.js' %}"></script>

{% endblock %}