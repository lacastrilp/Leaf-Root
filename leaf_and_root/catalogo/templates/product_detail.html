
{% load static %}
<style src="{% static 'carrito/css/cart.css' %}"></style>
<style src="{% static 'catalogo/css/wishlist.css' %}"></style>

{% block content %}
<div class="d-flex align-items-center mb-3">
  <h1 class="me-3">{{ product.name }}</h1>
  
  {% if product.diet_label %} <!--what the helly-->
    <span class="badge rounded-pill 
                {% if product.diet_label == 'vegan' %}bg-success
                {% elif product.diet_label == 'vegetarian' %}bg-warning text-dark
                {% endif %}">
      {{ product.diet_label|title }}
    </span>
  {% endif %}
</div>
{% if product.image_url %}
  <img src="{{ product.image_url }}" alt="{{ product.name }}" width="300">
{% endif %}

<form method="post" action="{% url 'toggle_wishlist' product.pk %}" 
  class="wishlist-form position-absolute top-0 end-0 m-2">
  {% csrf_token %}
  <button type="submit" class="btn p-0 border-0 bg-transparent">
      <i class="bi bi-heart wishlist-icon" 
      style="font-size:1.5rem; color:#666;"></i>
  </button>
</form>

<p><strong>Price:</strong> ${{ product.price }}</p>
<p><strong>Stock:</strong> {{ product.stock }}</p>
{% if product.stock <= 5 and product.stock > 0 %}
  <p class="text-warning">There are only {{ product.stock }} units left in stock</p>
{% elif product.stock == 0 %}
  <p class="text-danger">Out of stock</p>
{% endif %}
<p><strong>Description:</strong> {{ product.description }}</p>
<form method="post" action="{% url 'add_to_cart' product.pk %}?next={% url 'cart_detail' %}">
  {% csrf_token %}
  <input type="hidden" name="quantity" value="1">
  <button type="submit" class="btn btn-sm btn-success"
          {% if product.stock == 0 %}disabled{% endif %}>
      Add to shopping cart
  </button>
</form>




<h3>Reviews</h3>

{% for review in reviews %}
  <p>
    <b>{{ review.customer.name }}</b>:
    {{ review.comment }} (⭐ {{ review.rating }}/5)
  </p>
{% empty %}
  <p>There aren't any reviews yet.</p>
{% endfor %}

{% if user.is_authenticated %}
  <hr>
  <h4>Write your review</h4>
  <form method="post" action="{% url 'submit_review' product.pk %}">
    {% csrf_token %}
    {{ review_form.as_p }}
    <button type="submit" class="btn btn-secondary">Send review</button>
  </form>
{% else %}
  <p class="mt-3">
    <a href="{% url 'login' %}?next={{ request.path }}">Login to write a review</a>
  </p>
{% endif %}
<script src="{% static 'store/js/product-modal.js' %}"></script> <!-- JS específico de product detail -->
<script src="{% static 'carrito/js/cart.js' %}"></script> <!-- JS global de carrito -->
{% endblock %}
