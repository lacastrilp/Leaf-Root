{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load i18n %}
<link rel="stylesheet" href="{% static 'users/css/auth.css' %}">
<link rel="stylesheet" href="{% static 'store/css/base.css' %}">

<div class="auth-bg">

  <div class="auth-card auth-page">
    <h1 class="auth-title">{% trans "Login" %}</h1>
    <form method="post">
        {% csrf_token %}
        <div class="mb-3">
            <label for="{{ form.username.id_for_label }}" class="form-label">{% trans "Email or Username" %}</label>
            {{ form.username}}
            <div class="form-text">{% trans "You can sign in using your email address or your username." %}</div>

        </div>
        <div class="mb-3">
            {{ form.password }}
        </div>
        {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {{ form.non_field_errors }}
            </div>
        {% endif %}
        <button type="submit" class="btn btn-success" style="width: 300px;">{% trans "Sign in" %}</button>
    </form>
    <p class="mt-3 text-center">{% trans "Don't have an account?" %}</p>
    <a href="{% url 'register' %}" class="btn btn-secondary" style="width: 300px;">{% trans "Register here" %}</a>
  </div>
</div>

<script>
// Password visibility toggle
document.addEventListener("DOMContentLoaded", function () {
  try {
    const pwInputs = document.querySelectorAll('.auth-page input[type="password"]');
    const eyeClosedSvg = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M2.47 2.47l19.06 19.06" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9.53 9.53a3 3 0 004.24 4.24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 5c4.97 0 9 4.5 9 7s-4.03 7-9 7c-1.31 0-2.55-.25-3.67-.7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    const eyeOpenSvg = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>';

    pwInputs.forEach(function (input) {
      const wrapper = document.createElement('div');
      wrapper.className = 'password-toggle';
      input.parentNode.insertBefore(wrapper, input);
      wrapper.appendChild(input);

      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'toggle-password';
      btn.setAttribute('aria-label', 'Toggle password visibility');
      btn.innerHTML = eyeClosedSvg;
      wrapper.appendChild(btn);

      btn.addEventListener('click', function (e) {
        e.preventDefault();
        if (input.type === 'password') {
          input.type = 'text';
          btn.innerHTML = eyeOpenSvg;
        } else {
          input.type = 'password';
          btn.innerHTML = eyeClosedSvg;
        }
      });
    });
  } catch (err) {
    console.error('Error initializing password toggles', err);
  }
});
</script>
{% endblock %}
